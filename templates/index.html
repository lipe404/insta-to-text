<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Insta to Text</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
  </head>
  <body>
    <div class="background"></div>
    <main class="glass-card">
      <h1>Insta → Text</h1>
      <p class="subtitle">
        Cole a URL de um Reel/Post do Instagram e obtenha a transcrição.
      </p>

      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %}
      <div class="alerts">
        {% for category, message in messages %}
        <div class="alert {{ category }}">{{ message }}</div>
        {% endfor %}
      </div>
      {% endif %} {% endwith %}

      <form
        class="input-form"
        action="{{ url_for('transcribe') }}"
        method="POST"
        novalidate
      >
        <label for="instagram_url">URL do Instagram</label>
        <input
          type="url"
          id="instagram_url"
          name="instagram_url"
          placeholder="https://www.instagram.com/reel/XXXXXXXXX/"
          required
          pattern="https?://(www\.)?instagram\.com/.*"
        />
        <button type="submit">Transcrever</button>
      </form>

      {% if transcript %}
      <section class="result">
        <h2>Transcrição</h2>
        <div class="result-actions" style="display: flex; justify-content: flex-end; gap: 8px; margin-bottom: 8px;">
          <button type="button" id="copy-btn">Copiar texto</button>
          <span id="copy-status" aria-live="polite" style="font-size: 0.9em; color: #2e7d32; display: none;">Copiado!</span>
        </div>
        <pre class="transcript" id="transcript-text">{{ transcript }}</pre>
      </section>
      {% endif %}

      <footer>
        <small
          >Respeite os termos de uso do Instagram e do serviço de transcrição
          utilizado.</small
        >
      </footer>
    </main>
    <script>
      (function () {
        var btn = document.getElementById('copy-btn');
        if (!btn) return;
        var statusEl = document.getElementById('copy-status');
        var pre = document.getElementById('transcript-text');

        function showStatus(msg) {
          if (!statusEl) return;
          statusEl.textContent = msg;
          statusEl.style.display = 'inline';
          setTimeout(function () {
            statusEl.style.display = 'none';
          }, 1500);
        }

        btn.addEventListener('click', function () {
          if (!pre) return;
          var text = pre.textContent || '';
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(function () {
              showStatus('Copiado!');
            }).catch(function () {
              fallbackCopy(text);
            });
          } else {
            fallbackCopy(text);
          }
        });

        function fallbackCopy(text) {
          var textarea = document.createElement('textarea');
          textarea.value = text;
          textarea.style.position = 'fixed';
          textarea.style.top = '-9999px';
          document.body.appendChild(textarea);
          textarea.focus();
          textarea.select();
          try {
            var ok = document.execCommand('copy');
            showStatus(ok ? 'Copiado!' : 'Falhou');
          } catch (e) {
            showStatus('Falhou');
          }
          document.body.removeChild(textarea);
        }
      })();
    </script>
  </body>
</html>
